<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>AI Upscaler</title>

<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  .guide {
    text-align: center;
    margin: 20px auto;
    max-width: 1000px;
  }

  .guide h2 {
    margin-bottom: 12px;
  }

  .guide-actions {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
  }

  .guide-card {
    background: var(--guide-bg);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 18px;
    width: 300px;

    cursor: pointer;
    transition: all .3s ease;
  }

  .guide-card span {
    color: var(--primary);
  }

  .guide-card p {
    color: var(--text-soft);
  }

  .guide-card:hover {
    box-shadow:
        0 0 0 1px var(--secondary),
        0 0 20px rgba(236,72,153,.25);

    transform: translateY(-2px);
  }

  .steps {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;

    margin-top: 12px;
  }

  .steps div {
    background: var(--card);
    border: 1px solid var(--border);
    padding: 8px 12px;
    border-radius: 10px;
    font-size: 13px;
  }

  @media (max-width: 1000px) {
  .guide-actions {
      flex-direction: column;
      align-items: center;
  }

  .guide-card {
      width: 92%;
  }
  }

  .app {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  input[type="file"] {
    text-align: center;
    margin: 10px auto;
  }

  a {
    display: flex;
    justify-content: center;
  }

  :root {
    --bg: #eef1fa;
    --card: #f9faff;
    --surface: #e4e9f7;

    --topbar: #dfe5f6;

    --text: #0f172a;
    --text-soft: #475569;

    --primary: #4f46e5;
    --secondary: #ec4899;
    --success: #16a34a;

    --border: #cfd7f0;

    --btn-bg: #4f46e5;
    --guide-bg: #e8ecfa;

    --accent: #4f46e5;
    --accent2: #818cf8;
  }

  .dark {
    --bg: #13182b;
    --card: #1a2036;
    --surface: #1f2640;

    --topbar: #0f1322;

    --text: #e6ebff;
    --text-soft: #94a3b8;

    --primary: #818cf8;
    --secondary: #f472b6;
    --success: #4ade80;

    --border: #252e4d;

    --btn-bg: #6366f1;
    --guide-bg: #1d2440;

    --accent: #818cf8;
    --accent2: #c084fc;
  }

  * { box-sizing: border-box; }

  body {
    font-family: 'Outfit', Arial;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    transition:
      background-color .4s ease,
      color .4s ease;
  }

  .top-bar {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;

    padding: 14px 24px;

    background: linear-gradient(
      135deg,
      var(--topbar),
      var(--surface)
    );

    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 999;

    backdrop-filter: blur(12px);

    box-shadow: 0 4px 16px rgba(0,0,0,.08);
  }

  .dark .top-bar {
    box-shadow: 0 4px 16px rgba(0,0,0,.25);
  }

  .top-spacer {
    height: 1px;
  }

  .nav-center {
    display: flex;
    gap: 14px;
    justify-content: center;
  }

  .nav-btn {
    background: transparent;
    color: var(--text);

    border: 1px solid var(--border);
    border-radius: 999px;

    padding: 8px 18px;
    font-weight: 600;

    transition: all .25s ease;
  }

  .nav-btn:hover {
    background: linear-gradient(
      135deg,
      var(--accent),
      var(--accent2)
    );
    color: white;
    box-shadow: 0 0 18px rgba(99,102,241,.35);
    transform: translateY(-1px);
  }

  .theme-btn {
    justify-self: end;

    background: var(--bg);
    color: var(--text);

    border: 1px solid var(--border);
    border-radius: 12px;

    padding: 8px 14px;
    transition: all .25s ease;
  }

  .theme-btn:hover {
    box-shadow: 0 0 14px rgba(168,85,247,.35);
  }

  .header {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: white;
    padding: 40px 0;
    font-size: 42px;
    font-weight: 700;
    letter-spacing: .5px;
    text-align: center;
  }

  .section {
    background: var(--card);
    border: 1px solid var(--border);

    width: 1000px;
    margin: 24px auto;
    padding: 22px;

    border-radius: 18px;

    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;

    transition: all .28s ease;

    box-shadow:
      0 10px 20px rgba(0,0,0,.06),
      0 0 0 1px rgba(255,255,255,.4) inset;
  }

  .dark .section {
    box-shadow:
      0 10px 20px rgba(0,0,0,.25),
      0 0 0 1px rgba(255,255,255,.05) inset;
  }

  .section:hover {
    box-shadow:
        0 0 0 1px var(--accent),
        0 0 20px rgba(99,102,241,.25),
        0 15px 30px rgba(0,0,0,.12);

    transform: translateY(-2px);
  }

  button {
    background: var(--btn-bg);
    color: white;

    border: none;
    border-radius: 12px;
    padding: 10px 16px;
    margin: 6px;

    font-weight: 600;
    letter-spacing: .3px;

    cursor: pointer;
    font-family: 'Outfit';
    transition: .2s;
  }

  button:hover {
    background: var(--secondary);
    transform: translateY(-1px);
    box-shadow: 0 0 14px rgba(236,72,153,.35);
  }

  .scale-row {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin: 10px 0;
  }

  img, video {
    display: block;
    margin: 10px auto;
  }

  #status {
    position: fixed;

    top: 80px;
    right: 20px;

    z-index: 99999;

    min-width: 220px;
    max-width: 320px;

    background: var(--card);
    color: var(--text);
    border: 1px solid var(--border);

    padding: 12px 14px;
    border-radius: 14px;

    box-shadow: 0 12px 30px rgba(0,0,0,.18);

    transform: translateX(140%);
    transition: all .35s ease;
  }

  #status.show {
    transform: translateX(0);
  }

  body, .section, .top-bar, button, .header {
    transition:
        background .35s ease,
        color .25s ease,
        border .25s ease,
        box-shadow .3s ease;
  }

  @media (max-width: 1000px) {
  .section {
      width: 92%;
      padding: 16px;
  }

  img, video {
      max-width: 100%;
  }

  .header {
      font-size: 32px;
      padding: 28px 10px;
  }

  .scale-row {
      flex-wrap: wrap;
  }

  button {
      padding: 8px 12px;
      font-size: 14px;
  }
  }

  .nav-btn.active {
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;

    box-shadow:
      0 0 6px var(--primary),
      0 0 12px var(--secondary),
      0 0 20px rgba(236,72,153,.4);

    animation: neonPulse 2s infinite alternate;
  }

  @keyframes neonPulse {
    from {
      box-shadow:
        0 0 6px var(--primary),
        0 0 12px var(--secondary);
    }
    to {
      box-shadow:
        0 0 10px var(--primary),
        0 0 18px var(--secondary),
        0 0 26px rgba(236,72,153,.5);
    }
  }

  #backGuide {
    position: fixed;
    bottom: 24px;
    right: 24px;

    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: white;

    border: none;
    border-radius: 14px;

    padding: 12px 16px;
    font-weight: 600;

    cursor: pointer;

    opacity: 0;
    pointer-events: none;

    transition: all .3s ease;

    box-shadow:
      0 0 10px rgba(99,102,241,.4),
      0 0 20px rgba(236,72,153,.3);
  }

  #backGuide.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  #backGuide:hover {
    transform: translateY(-3px) scale(1.05);
  }

  .nav-btn:hover {
    animation: iconWiggle .4s ease;
  }

  @keyframes iconWiggle {
    0% { transform: rotate(0); }
    25% { transform: rotate(-6deg); }
    50% { transform: rotate(6deg); }
    100% { transform: rotate(0); }
  }

  .paper-wrapper {
    position: relative;
    height: 160px;
    perspective: 900px;
  }

  .paper {
    position: absolute;
    inset: 0;

    display: flex;
    align-items: center;
    justify-content: center;

    font-size: 26px;
    font-weight: 600;
    text-align: center;

    opacity: 0;
    transition: all .8s ease;

    color: var(--text);
    background: none;
    -webkit-text-fill-color: unset;

    text-shadow: 
      0 0 6px rgba(99,102,241,.35),
      0 0 12px rgba(236,72,153,.25);
  }

  .paper.active {
    opacity: 1;
    transform: rotateY(0) translateX(0) scale(1);
  }

  @keyframes glow {
    from {
      filter: drop-shadow(0 0 6px rgba(192,132,252,.4));
    }
    to {
      filter: drop-shadow(0 0 14px rgba(244,114,182,.7));
    }
  }

  .steps div:nth-child(1) {
  background: linear-gradient(135deg, #60a5fa22, #3b82f622);
  border-color: #60a5fa55;
  }

  .steps div:nth-child(2) {
    background: linear-gradient(135deg, #34d39922, #10b98122);
    border-color: #34d39955;
  }

  .steps div:nth-child(3) {
    background: linear-gradient(135deg, #fbbf2422, #f59e0b22);
    border-color: #fbbf2455;
  }

  .steps div:nth-child(4) {
    background: linear-gradient(135deg, #f472b622, #ec489922);
    border-color: #f472b655;
  }

  .steps div:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 12px rgba(99,102,241,.2);
  }

  .dark .paper {
  color: #e6ebff;
  text-shadow: 
    0 0 8px rgba(129,140,248,.6),
    0 0 14px rgba(244,114,182,.4);
  }

  .up-btn {
    position: relative;
    display: inline-block;
  }

  .up-menu {
    position: absolute;
    top: 42px;
    left: 0;

    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;

    min-width: 150px;
    overflow: hidden;

    opacity: 0;
    pointer-events: none;

    transform: translateY(6px);
    transition: all .2s ease;

    z-index: 999;
  }

  .up-menu div {
    padding: 10px 12px;
    cursor: pointer;
    font-size: 14px;
    color: var(--text);
  }

  .up-menu div:hover {
    background: linear-gradient(
      135deg,
      var(--primary),
      var(--secondary)
    );
    color: white;
  }

  .up-btn:hover .up-menu {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0);
  }

  .compare-box {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;

  width: 100%;
  max-width: 1000px;
  margin: 12px auto;
}

.compare-item {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;

  width: 100%;
  height: 420px;        /* ‚Üê C·ªê ƒê·ªäNH CHI·ªÄU CAO */
  position: relative;

  display: flex;
  align-items: center;
  justify-content: center;

  overflow: hidden;
}

.compare-item img,
.compare-item video {
  width: 100%;
  height: 100%;

  object-fit: contain;
  background: #000;
}

#beforeImg,
#beforeVideo,
#result,
#videoResult {
  display: none;
}

.label {
  position: absolute;
  top: 8px;
  left: 8px;

  background: rgba(0,0,0,.6);
  color: white;

  padding: 4px 10px;
  border-radius: 10px;
  font-size: 13px;

  backdrop-filter: blur(6px);
  z-index: 10;
}

@media (max-width: 900px) {
  .compare-box {
    grid-template-columns: 1fr;
  }

  .compare-item {
    height: 320px;
  }
}
</style>
</head>

<body>

<div class="top-bar">
  <div class="top-spacer"></div>

  <div class="nav-center">
    <button id="btnGuide" class="nav-btn" onclick="scrollToId('guideSection')">üìñ Guide</button>
    <button id="btnImage" class="nav-btn" onclick="scrollToId('imageSection')">üñº Image</button>
    <button id="btnVideo" class="nav-btn" onclick="scrollToId('videoSection')">üé¨ Video</button>
  </div>

  <button class="theme-btn" onclick="toggleTheme()" id="themeBtn">
    üåô Dark
  </button>
</div>

<p id="status"></p>

<div class="header">
  <div class="paper-wrapper" id="paperBox">

    <div class="paper active">
      AI Image Upscaler ‚Äì A product by "Ch√∫ng t√¥i ƒë∆°n gi·∫£n l√† SVBK"
    </div>

    <div class="paper">
      72% users upscale old photos for social media
    </div>

    <div class="paper">
      Best choice: 2x for portraits ‚Äì 4x for text
    </div>

    <div class="paper">
      Sharper resolution = more professional look
    </div>

  </div>
</div>

<div class="guide" id="guideSection">
  <h2>What would you like to upscale?</h2>

  <div class="guide-actions">
    <div class="guide-card" onclick="scrollToId('imageSection')">
      üñº <span>Upscale Image</span>
      <p>Enhance photos, artworks, screenshots up to 4x quality</p>
    </div>

    <div class="guide-card" onclick="scrollToId('videoSection')">
      üé¨ <span>Upscale Video</span>
      <p>Improve resolution of MP4/MOV videos with AI</p>
    </div>
  </div>

  <div class="steps">
    <div>1. Choose Image or Video</div>
    <div>2. Upload your file</div>
    <div>3. Select Upscale 2x / 3x / 4x</div>
    <div>4. Download result</div>
  </div>
</div>
    
<p style="text-align:center">
Professional AI-powered image enhancement
</p>

<div class="section" id="imageSection">
<h2>üñº Image Upscale</h2>

<input type="file" id="file" accept="image/*">

<div class="scale-row">

  <div class="up-btn">
    <button>Upscale 2x ‚ñæ</button>
    <div class="up-menu">
      <div onclick="uploadImg('/api/upscale2x')">2x Normal</div>
      <div onclick="uploadImg('/api/upscale2x_noise')">2x Noise</div>
      <div onclick="uploadImg('/api/upscale2x_sharp')">2x Sharpen</div>
    </div>
  </div>

  <div class="up-btn">
    <button>Upscale 3x ‚ñæ</button>
    <div class="up-menu">
      <div onclick="uploadImg('/api/upscale3x')">3x Normal</div>
      <div onclick="uploadImg('/api/upscale3x_noise')">3x Noise</div>
      <div onclick="uploadImg('/api/upscale3x_sharp')">3x Sharpen</div>
    </div>
  </div>

  <div class="up-btn">
    <button>Upscale 4x ‚ñæ</button>
    <div class="up-menu">
      <div onclick="uploadImg('/api/upscale4x')">4x Normal</div>
      <div onclick="uploadImg('/api/upscale4x_noise')">4x Noise</div>
      <div onclick="uploadImg('/api/upscale4x_sharp')">4x Sharpen</div>
    </div>
  </div>

</div>

<div class="compare-box">
  <div class="compare-item">
    <div class="label">Before</div>
    <img id="beforeImg">
  </div>

  <div class="compare-item">
    <div class="label">After</div>
    <img id="result">
  </div>
</div>

<br>
<a id="downloadLink" href="#">
  <button>Download Image</button>
</a>
</div>

<div class="section" id="videoSection">

<h2>üé¨ Video Upscale</h2>

<input type="file" id="video2" accept="video/*">

<div class="scale-row">

  <div class="up-btn">
    <button>Upscale 2x ‚ñæ</button>
    <div class="up-menu">
      <div onclick="uploadVideo('/api/upscaleVideo2x')">2x Normal</div>
      <div onclick="uploadVideo('/api/upscaleVideo2x_noise')">2x Noise</div>
      <div onclick="uploadVideo('/api/upscaleVideo2x_sharp')">2x Sharpen</div>
    </div>
  </div>

  <div class="up-btn">
    <button>Upscale 3x ‚ñæ</button>
    <div class="up-menu">
      <div onclick="uploadVideo('/api/upscaleVideo3x')">3x Normal</div>
      <div onclick="uploadVideo('/api/upscaleVideo3x_noise')">3x Noise</div>
      <div onclick="uploadVideo('/api/upscaleVideo3x_sharp')">3x Sharpen</div>
    </div>
  </div>

  <div class="up-btn">
    <button>Upscale 4x ‚ñæ</button>
    <div class="up-menu">
      <div onclick="uploadVideo('/api/upscaleVideo4x')">4x Normal</div>
      <div onclick="uploadVideo('/api/upscaleVideo4x_noise')">4x Noise</div>
      <div onclick="uploadVideo('/api/upscaleVideo4x_sharp')">4x Sharpen</div>
    </div>
  </div>

</div>

<div class="compare-box">
  <div class="compare-item">
    <div class="label">Before</div>
    <video id="beforeVideo" controls></video>
  </div>

  <div class="compare-item">
    <div class="label">After</div>
    <video id="videoResult" controls></video>
  </div>
</div>

<br>
<a id="downloadLinkVideo" href="#">
  <button>Download Video</button>
</a>

</div>

<script>
function setStatus(text) {
  const st = document.getElementById("status");

  st.innerText = text;
  st.classList.add("show");

  // t·ª± ·∫©n sau 4s n·∫øu l√† th√¥ng b√°o ho√†n th√†nh
  if (text.includes("‚úÖ") || text.includes("‚ùå")) {
    setTimeout(() => {
      st.classList.remove("show");
    }, 4000);
  }
}

function scrollToId(id){
  const el = document.getElementById(id);

  const topBarHeight =
    document.querySelector(".top-bar").offsetHeight || 70;

  const y =
    el.getBoundingClientRect().top +
    window.pageYOffset -
    topBarHeight -
    10;

  window.scrollTo({
    top: y,
    behavior: "smooth"
  });
}

document.getElementById("file").addEventListener("change", function(){
  const st = document.getElementById("status");
  const file = this.files[0];

  if (!file) return;

  // Ch·ªâ cho ph√©p ·∫£nh
  if (!file.type.startsWith("image/")) {
    setStatus("‚ö† Only image files are allowed in Image section");
    st.style.color = "#f87171";
    this.value = "";
    return;
  }

  // ===== QUAN TR·ªåNG ‚Äì HI·ªÇN TH·ªä NGAY =====
  const before = document.getElementById("beforeImg");
  before.src = URL.createObjectURL(file);
  before.style.display = "block";
  // ======================================

  setStatus("üìå Image selected ‚Äì please choose Upscale 2x / 3x / 4x");
  st.style.color = "#60a5fa";
});

document.getElementById("video2").addEventListener("change", function(){
  const st = document.getElementById("status");
  const file = this.files[0];

  if (!file) return;

  // Ch·ªâ cho ph√©p video
  if (!file.type.startsWith("video/")) {
    setStatus("‚ö† Only video files are allowed in Video section");
    st.style.color = "#f87171";
    this.value = "";
    return;
  }

  // ===== HI·ªÇN TH·ªä VIDEO NGAY =====
  const beforeV = document.getElementById("beforeVideo");
  beforeV.src = URL.createObjectURL(file);
  beforeV.style.display = "block";
  beforeV.load();
  // ===============================

  setStatus("üìå Video selected ‚Äì please choose Upscale 2x / 3x / 4x");
  st.style.color = "#60a5fa";
});

async function uploadImg(url){
 let start = performance.now();

 const f = document.getElementById("file");
 const st = document.getElementById("status");
 const img = document.getElementById("result");
 const link = document.getElementById("downloadLink");

 if(!f.files.length){
   st.style.display = "block";
   setStatus("‚ö† Please select an image first");
   st.style.color = "#f87171";
   return;
 }

 if(!f.files[0].type.startsWith("image/")){
  setStatus("‚ö† Invalid file type ‚Äì only image allowed");
  st.style.color = "#f87171";
  return;
}

 st.style.display = "block";
 setStatus("‚è≥ Uploading...");
 st.style.color="#4ade80";

 let fd=new FormData();
 fd.append("file",f.files[0]);

 const res=await fetch(url,{method:"POST",body:fd});
 const {uid}=await res.json();

 setStatus("‚öôÔ∏è Processing...");

 const t=setInterval(async()=>{
   const r=await fetch(`/api/image_status/${uid}`);
   const s=await r.json();

   if(s.status==="done"){
     clearInterval(t);
     startPaper();

    const u=s.result+"?t="+Date.now();
    img.src=u;
    img.style.display = "block";

     img.onload=()=>{
       st.innerText=
         `‚úÖ Done in ${((performance.now()-start)/1000).toFixed(2)}s`;
     };

     link.href=u;
     link.download="upscaled.png";
   }
 },3000);
}

async function uploadVideo(url){
 let start=performance.now();

 const f=document.getElementById("video2");
 const v=document.getElementById("videoResult");
 const st=document.getElementById("status");
 const link=document.getElementById("downloadLinkVideo");

 if(!f.files.length){
   st.style.display = "block";
   setStatus("‚ö† Please select a video first");
   st.style.color = "#f87171";
   return;
 }

 if(!f.files[0].type.startsWith("video/")){
  setStatus("‚ö† Invalid file type ‚Äì only video allowed");
  st.style.color = "#f87171";
  return;
}

 v.src=""; 
 v.load();

 let fd=new FormData();
 fd.append("file",f.files[0]);

 st.style.display = "block";
 st.innerText="‚è≥ Uploading...";
 st.style.color="#4ade80";

 const res=await fetch(url,{method:"POST",body:fd});
 const {task_id}=await res.json();

 setStatus("‚öôÔ∏è Processing...");

 const t=setInterval(async()=>{
   const r=await fetch(`/api/video_status/${task_id}`);
   const s=await r.json();

   if(s.status==="done"){
     clearInterval(t);
     startPaper();

     const u=`/api/download/${task_id}?t=${Date.now()}`;
     v.src=u;
     v.style.display = "block";

     v.onloadeddata=()=>{
       st.innerText=
         `‚úÖ Done in ${((performance.now()-start)/1000).toFixed(2)}s`;
     };

     link.href=u;
     link.download="upscaled.mp4";
   }
 },3000);
}

function toggleTheme(){
 document.body.classList.toggle("dark");
 const b=document.getElementById("themeBtn");

 const d=document.body.classList.contains("dark");
 b.innerText=d?"‚òÄ Light":"üåô Dark";
 localStorage.setItem("theme",d?"dark":"light");
}

window.onload=()=>{
 if(localStorage.getItem("theme")==="dark"){
    document.body.classList.add("dark");
    document.getElementById("themeBtn").innerText="‚òÄ Light";
 }
};

const sections = {
  guideSection: document.getElementById("btnGuide"),
  imageSection: document.getElementById("btnImage"),
  videoSection: document.getElementById("btnVideo")
};

const observer = new IntersectionObserver(entries => {
  entries.forEach(e => {
    if (e.isIntersecting) {
      Object.values(sections).forEach(b => b.classList.remove("active"));

      const btn = sections[e.target.id];
      if (btn) btn.classList.add("active");
    }
  });
}, {
  threshold: 0.25,
  rootMargin: "-80px 0px -45% 0px"
});

observer.observe(document.getElementById("guideSection"));
observer.observe(document.getElementById("imageSection"));
observer.observe(document.getElementById("videoSection"));

window.addEventListener("scroll", () => {
  const back = document.getElementById("backGuide");
  if (!back) return;

  if (window.scrollY > 420) {
    back.classList.add("show");
  } else {
    back.classList.remove("show");
  }
});

window.addEventListener("scroll", () => {
  const y = window.scrollY;

  if (y > 420) {
    back.classList.add("show");
  } else {
    back.classList.remove("show");
  }
});

let paperIndex = 0;
let paperTimer;

function startPaper(){
  const papers =
    document.querySelectorAll(".paper");

  paperTimer = setInterval(() => {

    papers[paperIndex]
      .classList.remove("active");

    paperIndex =
      (paperIndex + 1) % papers.length;

    papers[paperIndex]
      .classList.add("active");

  }, 5000);
}

window.addEventListener("DOMContentLoaded", startPaper);

["file","video2"].forEach(id=>{
  document.getElementById(id)
  .addEventListener("change",()=>{
    clearInterval(paperTimer);
  });
});
</script>

<button id="backGuide" onclick="scrollToId('guideSection')">
  ‚Üë Back to Guide
</button>

</body>
</html>
